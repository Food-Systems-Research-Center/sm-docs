{
  "hash": "fa3be49407688be29070441cb8ad3617",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Environment Indicator Refinement\"\nformat:\n  html:\n    fig-dpi: 200\n---\n\n::: {.cell}\n\n:::\n\n\n\n\nThis page describes the various iterations of indicator sets for the environment dimension. First, we observe the indicators included in the dimension at three points in time. The second section then shows the results of the survey following the indicator refinement meeting. A final set of indicators to incorporate into the next RFP is still in the works!\n\n## Indicator Progression\n\n### Wiltshire\n\nThis graph shows the original framework for the dimension as described in the Wiltshire et al. paper.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Use custom function in SMDO repo\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/wiltshire_tree.csv',\n  dimension_in = 'Environment',\n  y_limits = c(-1.5, 2.1),\n  palette = \"ggthemes::stata_s2color\"\n)\n```\n\n::: {.cell-output-display}\n![](refine_environment_files/figure-html/wiltshire_dendro-1.png){fig-align='center' width=2000}\n:::\n:::\n\n\n\n\n### Matrix\n\nHere is the current set of indicators in the matrix, following the Sustainability Metrics workshop in July, 2024\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Use custom function in SMDO repo\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/matrix_tree.csv',\n  dimension_in = 'Environment',\n  y_limits = c(-1.5, 2.1),\n  palette = \"ggthemes::stata_s2color\"\n)\n```\n\n::: {.cell-output-display}\n![](refine_environment_files/figure-html/matrix_dendro-1.png){fig-align='center' width=2200}\n:::\n:::\n\n\n\n\n### Refinement Meeting\n\nFinally, the tentative set of indicators following the indicator refinement meeting on November 22nd, 2024\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Use custom function in SMDO repo\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/env_meeting_tree.csv',\n  dimension_in = 'Environment',\n  y_limits = c(-1.5, 2.1),\n  palette = \"ggthemes::stata_s2color\"\n)\n```\n\n::: {.cell-output-display}\n![](refine_environment_files/figure-html/meeting_dendro-1.png){fig-align='center' width=2000}\n:::\n:::\n\n\n\n\n## Survey\n\nThese are the results from the follow-up survey to the economic indicator refinement meeting on November 15th. This feedback will be used to refine the framework for the next RFP.\n\n### Indicators\n\n\n\n\n::: {.cell warnings='false'}\n\n```{.r .cell-code}\nraw <- read_csv('data/surveys/env_survey.csv')\n\ndat <- raw %>% \n  select(\n    ends_with('GROUP'),\n  ) %>% \n  setNames(c(\n    'indi_must',\n    'indi_probably',\n    'indi_probably_not',\n    'indi_must_not',\n    'idx_must',\n    'idx_probably',\n    'idx_probably_not',\n    'idx_must_not'\n  )) %>% \n  .[-c(1:2), ]\n\nto_df <- function(x) {\n  x %>%\n    str_replace_all('PFAS, PFOS', 'PFAS/PFOS') %>% \n    str_replace_all('soil loss/', 'Soil loss/') %>% \n    str_split(',') %>% \n    unlist() %>% \n    table() %>% \n    as.data.frame() %>% \n    setNames(c('indicator', 'freq')) %>% \n    arrange(desc(freq))\n}\n\nindi_out <- map(dat[1:4], to_df)\nidx_out <- map(dat[5:8], to_df)\n\n# Add scores by multipliers\nmultipliers <- c(3:0)\nind_tables <- map2(indi_out, multipliers, ~ {\n  .x %>% \n    mutate(\n      freq = as.numeric(freq),\n      multiplier = .y,\n      score = freq * multiplier,\n    ) %>% \n    select(indicator, freq, score)\n})\n\n# Set up DF for color graph \ngraph_table <- imap(ind_tables, ~ {\n  col_name <- str_remove(.y, 'indi_')\n  .x %>% \n    rename(!!sym(col_name) := freq) %>% \n    select(-score)\n}) %>% \n  reduce(full_join) %>% \n  mutate(\n    across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)),\n    sort_key = must * 1e6 + probably * 1e4 + probably_not * 1e2 + must_not,\n    indicator = fct_reorder(indicator, sort_key, .desc = TRUE)\n  ) %>% \n  pivot_longer(\n    cols = must:must_not,\n    names_to = \"category\",\n    values_to = \"count\"\n  ) %>% \n  mutate(\n    category = fct_relevel(\n      category, \n      \"must_not\",\n      \"probably_not\", \n      \"probably\", \n      \"must\"\n    )\n  ) %>%\n  group_by(indicator) %>%\n  mutate(proportion = count / sum(count)) %>%\n  ungroup()\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(graph_table, aes(\n  y = reorder(indicator, sort_key),\n  x = proportion, \n  fill = category\n)) +\n  geom_col(position = \"stack\") +  \n  labs(\n    y = \"Indicator\",\n    x = \"Proportion\",\n    fill = \"Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 20),\n    legend.position = 'top'\n    ) +\n  scale_fill_brewer(\n    palette = \"RdBu\", \n    direction = -1,\n    limits = c(\n      \"must\",\n      \"probably\", \n      \"probably_not\", \n      \"must_not\" \n    ),\n    labels = c(\n      \"Must Include\", \n      \"Probably Include\", \n      \"Probably Not Include\", \n      \"Must Not Include\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](refine_environment_files/figure-html/indi_graph-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\nWe are coding this so \"Must Include\" is worth 3 points, \"Probably Include\" is worth 2 points, \"Probably Not Include\" is worth 1 point, and \"Must Not Include\" is worth 0 points. Note that the last column is the sum of proportions of \"Must Include\" and \"Probably Include\". You can sort, search, expand, or page through the table below.\n\n\n\n\n::: {.cell warnings='false' class='centered-table'}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-a1f2c2251e43fcce62dc\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a1f2c2251e43fcce62dc\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Indicator\":[\"NEW - Carbon fluxes\",\"NEW - Carbon stocks\",\"NEW - Soil biology\",\"NEW - Forest complexity\",\"NEW - Soil chemistry\",\"NEW - Soil structure\",\"NEW - Water quantity and trends\",\"Biodiversity/species diversity\",\"Land-use diversity\",\"NEW - Water quality\",\"Tree vigor\",\"NEW - Embodied carbon/carbon footprint\",\"Sensitive/rare habitats\",\"Greenhouse gas emissions\",\"energy efficiency\",\"Waste generated/disposed of; contaminated (PFAS/PFOS)\",\"Aboveground biomass\",\" Soil loss/sedimentation\",\"Quality/quantity of surface and shallow subsurface water\",\"Soil cover\",\"Water quality of runoff\",\"Water stability\",\"External nutrient use efficiency\",\"Forest pest populations\",\"Protected waterways\",\"Environmental impacts of land use\",\"Acres in conservation practices\",\"Enrollment in certification program\",\"Regeneration of maple\",\"Water use/irrigation efficiency\",\"Adoption of BMPs\",\"Bacterial and fungal biomass\",\"Open Acres\",\"Pollinators\",\"Soil aggregate stability\",\"Soil carbon pools and flows\",\"Alpha and beta microbial diversity\",\"Climate change\",\"Microinvertebrate composition\"],\"Score\":[15,15,15,14,14,14,14,13,12,12,12,11,10,9,8,8,7,6,6,6,6,6,6,6,6,5,5,5,5,5,4,4,4,4,4,4,3,3,3],\"Proportion Must Include\":[\"1.00\",\"1.00\",\"1.00\",\"0.80\",\"0.80\",\"0.80\",\"0.80\",\"0.80\",\"0.60\",\"0.60\",\"0.60\",\"0.60\",\"0.40\",\"0.40\",\"0.20\",\"0.20\",\"0.00\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.00\",\"0.00\",\"0.00\",\"0.20\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"Proportion Must OR Probably Include\":[\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"0.80\",\"0.80\",\"0.80\",\"0.80\",\"0.80\",\"0.60\",\"0.40\",\"0.40\",\"0.40\",\"0.40\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.20\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"]},\"columns\":[{\"id\":\"Indicator\",\"name\":\"Indicator\",\"type\":\"factor\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"left\"},{\"id\":\"Score\",\"name\":\"Score\",\"type\":\"numeric\",\"format\":{\"cell\":{\"digits\":0},\"aggregated\":{\"digits\":0}},\"minWidth\":75,\"align\":\"right\"},{\"id\":\"Proportion Must Include\",\"name\":\"Proportion Must Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"},{\"id\":\"Proportion Must OR Probably Include\",\"name\":\"Proportion Must OR Probably Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"}],\"resizable\":true,\"searchable\":true,\"defaultPageSize\":10,\"showPageSizeOptions\":true,\"pageSizeOptions\":[5,10,25,50,100],\"bordered\":true,\"striped\":true,\"compact\":true,\"inline\":true,\"dataKey\":\"54e49a28a8420428c5f592c90c7a6b99\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\n### Indices\n\n\n\n\n::: {.cell layout-align=\"center\" warnings='false'}\n\n```{.r .cell-code}\n# Add scores by multipliers\nmultipliers <- c(3:0)\nidx_tables <- map2(idx_out, multipliers, ~ {\n  .x %>% \n    mutate(\n      freq = as.numeric(freq),\n      multiplier = .y,\n      score = freq * multiplier,\n    ) %>% \n    select(index = indicator, freq, score)\n})\n\n# Set up DF for color graph \ngraph_table <- imap(idx_tables, ~ {\n  col_name <- str_remove(.y, 'idx_')\n  .x %>% \n    rename(!!sym(col_name) := freq) %>% \n    select(-score)\n}) %>% \n  reduce(full_join) %>% \n  mutate(\n    across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)),\n    sort_key = must * 1e6 + probably * 1e4 + probably_not,\n    sort_key = ifelse(str_detect(index, 'Carbon'), 5e6, sort_key),\n    index = fct_reorder(index, sort_key, .desc = TRUE)\n  ) %>% \n  pivot_longer(\n    cols = must:must_not,\n    names_to = \"category\",\n    values_to = \"count\"\n  ) %>% \n  mutate(\n    category = fct_relevel(\n      category, \n      \"must_not\",\n      \"probably_not\", \n      \"probably\", \n      \"must\"\n    )\n  ) %>%\n  group_by(index) %>%\n  mutate(proportion = count / sum(count)) %>%\n  ungroup()\n\n\ncolors <- RColorBrewer::brewer.pal(4, 'RdBu')\n\nggplot(graph_table, aes(\n  y = reorder(index, sort_key),\n  x = proportion, \n  fill = category\n)) +\n  geom_col(position = \"stack\") +  \n  labs(\n    y = \"Index\",\n    x = \"Proportion\",\n    fill = \"Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 20),\n    legend.position = 'top'\n    ) +\n  scale_fill_manual(\n    values = rev(colors),\n    limits = c(\n      \"must\",\n      \"probably\",\n      \"probably_not\",\n      'must_not'\n    ),\n    labels = c(\n      \"Must Include\",\n      \"Probably Include\",\n      \"Probably Not Include\",\n      \"Must Not Include\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](refine_environment_files/figure-html/idx_graphs-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\nThe indices are going through the same treatment as indicators above - scored from 3 to 0. Note here that the \"Carbon ($ GHGs/nutrients)\" index seems to be missing a vote. So, it only has 12 points, but the proportion of votes for \"Must Include\" is 1.\n\n\n\n\n::: {.cell warnings='false' class='centered-table'}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-79d47ddaad89c69c215a\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-79d47ddaad89c69c215a\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Index\":[\"NEW - Forest\",\"NEW - Soils\",\"NEW - Water\",\"NEW - Species & Habitat\",\"NEW - Carbon (& GHGs/nutrients)\",\"Air quality\",\"Solid waste\",\"Biodiversity\",\"Best management\",\"Forest health\",\"Soil biology\",\"Soil health\",\"Water quality\",\"Resource use efficiency\"],\"Score\":[15,15,15,13,12,8,8,7,6,5,5,5,5,4],\"Proportion Must Include\":[\"1.00\",\"1.00\",\"1.00\",\"0.80\",\"1.00\",\"0.20\",\"0.20\",\"0.20\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"Proportion Must OR Probably Include\":[\"1.00\",\"1.00\",\"1.00\",\"0.80\",\"1.00\",\"0.40\",\"0.40\",\"0.20\",\"0.20\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"]},\"columns\":[{\"id\":\"Index\",\"name\":\"Index\",\"type\":\"factor\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"left\"},{\"id\":\"Score\",\"name\":\"Score\",\"type\":\"numeric\",\"format\":{\"cell\":{\"digits\":0},\"aggregated\":{\"digits\":0}},\"minWidth\":75,\"align\":\"right\"},{\"id\":\"Proportion Must Include\",\"name\":\"Proportion Must Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"},{\"id\":\"Proportion Must OR Probably Include\",\"name\":\"Proportion Must OR Probably Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"}],\"resizable\":true,\"searchable\":true,\"pagination\":false,\"defaultPageSize\":10,\"showPageSizeOptions\":false,\"bordered\":true,\"striped\":true,\"compact\":true,\"inline\":true,\"dataKey\":\"0a3a23f958c480eb5785ceb146589cf5\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react-dom.min.js\"></script>\n<script src=\"../site_libs/reactwidget-2.0.0/react-tools.js\"></script>\n<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/reactable-0.4.4/reactable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/reactable-binding-0.4.4/reactable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}