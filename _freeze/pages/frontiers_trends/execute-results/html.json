{
  "hash": "47cd56f2c56c63f98bdf736996a9c446",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Frontiers Submission\"\nformat:\n  html:\n    fig-dpi: 200\n    code-fold: true\neditor_options: \n  chunk_output_type: console\nwarnings: false\n---\n\n\n\n\n::: {.callout-note collapse='false' title='Caution'}\nMetrics and analyses for the Frontiers special issue are works in progress. \n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 999)\n\npacman::p_load(\n  dplyr,\n  stringr,\n  tidyr,\n  reactable,\n  glmnet,\n  missRanger,\n  purrr,\n  broom,\n  caret\n)\n\n# Functions\nsource('dev/data_pipeline_functions.R')\nsource('dev/get_reactable.R')\n\nconflicts_prefer(\n  dplyr::select(),\n  dplyr::filter(),\n  dplyr::pull(),\n  .quiet = TRUE\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load metrics\nsm_data <- readRDS('data/sm_data.rds')\nmetrics <- sm_data$metrics\nmeta <- sm_data$metadata\n\n# Load frame\nframe <- readRDS('data/frameworks/new_frame.rds')\n```\n:::\n\n\n\n\nThis page \nThis page explores what data we have available at the county level specifically.\n\n\nIt is branching off of the main \"Analysis\" pages because they are state-level analyses and I want to leave it there for posterity.\n\n\n## Explore Metrics and Resolution\n\nCheck how many metrics we have:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvars <- frame %>% \n  filter(variable_name != 'NONE') %>% \n  pull(variable_name)\ncount <- length(vars)\n```\n:::\n\n\n\n\nWe have 124 metrics overall\n\nCheck which metrics are available at state vs county levels.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_str(metrics)\n\n# Filter to vars, remove state fips codes\nvar_metrics <- metrics %>%\n  filter(\n    variable_name %in% vars\n  )\nget_str(var_metrics)\nlength(unique(var_metrics$variable_name))\n\n# Check how many are left\nout <- var_metrics %>% \n  filter(str_length(fips) == 5) %>% \n  pull(variable_name) %>% \n  unique() %>% \n  length()\nout\nperc_county <- out / length(unique(var_metrics$variable_name))\n# 73 (58%) are at the county level. Better\n```\n:::\n\n\n\n\n73 (58.9%) are available at county level.\n\nMake a table to explore what we have at each level:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## What do we ONLY have at the state level?\ncounty_metrics <- var_metrics %>% \n  filter(str_length(fips) == 5) %>% \n  pull(variable_name) %>%\n  unique()\nstate_metrics <- var_metrics %>% \n  filter(str_length(fips) == 2) %>% \n  pull(variable_name) %>%\n  unique()\n(state_only <- setdiff(state_metrics, county_metrics))\nlength(state_only)\n\n# Back to frame for context\nstate_only_frame <- frame %>% \n  filter(variable_name %in% state_only)\nstate_only_frame\n\n\n## Get the ones that are available at county level\nget_str(frame)\ncounty_df <- frame %>% \n  filter(\n    !variable_name %in% state_only_frame$variable_name,\n    variable_name != 'NONE'\n  )\nget_str(county_df)\n\n# Save just the county level variables here for analyses\ncounty_vars <- county_df$variable_name\n\n# We actually want a DF with a column that specifies the difference\ndf <- frame %>% \n  filter(variable_name != 'NONE') %>% \n  mutate(has_county = case_when(\n    variable_name %in% county_df$variable_name ~ TRUE,\n    .default = FALSE\n  ))\nget_str(df)\n\n# Save this somewhere for some reason\nwrite.csv(df, 'data/frontiers/metric_resolution.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_reactable(df, defaultPageSize = 5)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-e09a3e5390ebf039e5c9\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e09a3e5390ebf039e5c9\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"dimension\":[\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"economics\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"environment\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"health\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"production\",\"social\",\"social\",\"social\",\"social\",\"social\",\"social\",\"social\",\"social\",\"social\",\"social\"],\"index\":[\"access to capital/credit\",\"access to capital/credit\",\"access to capital/credit\",\"access to capital/credit\",\"access to capital/credit\",\"access to capital/credit\",\"access to capital/credit\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"community economy\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"food business resilience\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"carbon, ghg, nutrients\",\"forest\",\"forest\",\"forest\",\"forest\",\"forest\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"species and habitat\",\"water\",\"water\",\"water\",\"water\",\"water\",\"water\",\"water\",\"water\",\"water\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"food security\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"physical health\",\"imports vs exports\",\"imports vs exports\",\"production diversity\",\"production margins\",\"production margins\",\"production margins\",\"production margins\",\"production margins\",\"production margins\",\"production margins\",\"production margins\",\"waste and losses\",\"waste and losses\",\"waste and losses\",\"waste and losses\",\"waste and losses\",\"waste and losses\",\"waste and losses\",\"community embeddedness\",\"community embeddedness\",\"community embeddedness\",\"community livability\",\"community livability\",\"community livability\",\"food and farmworker diversity\",\"food and farmworker diversity\",\"food and farmworker diversity\",\"food system governance\"],\"indicator\":[\"access to land\",\"access to land\",\"access to land\",\"access to land\",\"access to land\",\"access to land\",\"access to land\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"wealth/income distribution\",\"income stability\",\"income stability\",\"income stability\",\"labor costs\",\"labor costs\",\"labor costs\",\"operations diversification\",\"operations diversification\",\"operations diversification\",\"use of ag/farm/crop insurance\",\"carbon fluxes\",\"carbon fluxes\",\"carbon fluxes\",\"carbon fluxes\",\"carbon stocks\",\"carbon stocks\",\"carbon stocks\",\"embodied carbon\",\"embodied carbon\",\"embodied carbon\",\"embodied carbon\",\"forest health\",\"forest health\",\"forest health\",\"forest health\",\"forest health\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"biodiversity\",\"land use diversity\",\"sensitive or rare habitats\",\"sensitive or rare habitats\",\"water quality\",\"water quality\",\"water quality\",\"water quality\",\"water quality\",\"water quality\",\"water quantity\",\"water quantity\",\"water quantity\",\"access to culturally appropriate food\",\"dietary quality\",\"dietary quality\",\"dietary quality\",\"food access\",\"food access\",\"food access\",\"food access\",\"food affordability\",\"food affordability\",\"food affordability\",\"food affordability\",\"food affordability\",\"food affordability\",\"access to care\",\"access to care\",\"access to care\",\"housing supply and quality\",\"housing supply and quality\",\"housing supply and quality\",\"housing supply and quality\",\"housing supply and quality\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"physical health tbd\",\"total quantity exported\",\"total quantity imported\",\"production species diversity\",\"production inputs\",\"total quantity food products\",\"total quantity food products\",\"total quantity forest products\",\"total quantity non-food ag products\",\"total quantity non-food ag products\",\"value added market\",\"value added market\",\"crop failure\",\"crop failure\",\"crop failure\",\"crop failure\",\"crop failure\",\"crop failure\",\"crop failure\",\"social connectedness\",\"social connectedness\",\"social connectedness\",\"community safety\",\"diverse representation\",\"diverse representation\",\"age diversity\",\"gender diversity\",\"racial diversity\",\"participatory governance\"],\"metric\":[\"Mean acres per farm\",\"Median acres per farm\",\"Land and building value per acre\",\"Land and building value per farm\",\"Capital expenditures, buildings and land, exc...\",\"Capital consumption, all, excl. operator dwel...\",\"Interest expenses, real estate, excl. operato...\",\"Median earnings (dollars) for female, farming...\",\"Median earnings (dollars) for female, food pr...\",\"Median earnings (dollars) for male, farming, ...\",\"Median earnings (dollars) for male, food prep...\",\"Women's earnings as a percentage of men's ear...\",\"Women's earnings as a percentage of men's ear...\",\"Gender pay gap\",\"Income inequality\",\"Gini Index\",\"Unemployment Rate\",\"Net return to operators\",\"Labor expenses as percentage of expenses\",\"mean farm related income per operation\",\"Number of migrant workers\",\"Number of short-term workers\",\"Number of unpaid workers\",\"Farms, direct-to-consumer sales as a percent ...\",\"Agritourism, sales as a percent of all farm s...\",\"Farms, local marketing channel sales as a per...\",\"Proportion of area (by county) affected by FS...\",\"Total CH4 emissions from agriculture (Tg)\",\"Total CO2 emissions from agriculture (Tg)\",\"Total N2O emissions from agriculture (Tg)\",\"Air pollution - particulate matter\",\"Forest carbon - dead and down\",\"Forest carbon - live standing\",\"Forest carbon - standing dead\",\"Operations using geoexchange\",\"Operations with methane digesters\",\"Operations with solar power\",\"Operations with wind power\",\"Dead trees per forested acre\",\"Forest canopy cover\",\"Forest live tree volume per acre\",\"Forest stand height\",\"Live trees per forested acre\",\"Percentage of animal species at risk\",\"Percentage of bee species at risk\",\"Percentage of orchid species at risk\",\"Percentage of plant species at risk\",\"Total number of animal species\",\"Total number of bee species\",\"Total number of orchid species\",\"Total number of plant species\",\"Land Use Diversity\",\"Percentage of ecosystems at risk\",\"Total number of ecosystems\",\"Lake habitat complexity condition class\",\"Riparian vegetation condition class\",\"Riparian vegetation condition, based on L_XCM...\",\"Site condition class based on conductivity\",\"Site condition class based on total nitrogen ...\",\"Site condition class based on total phosphoru...\",\"Expenses from water for irrigation sourced of...\",\"Total expenses from water for irrigation sour...\",\"Mean percent area in drought\",\"SFAs serving culturally relevant food\",\"SFAs percentage of spending on local food\",\"SFAs serving local food\",\"SFAs with Farm to School program\",\"Community Supported Agriculture (CSA), number...\",\"Farmers markets, number of businesses\",\"Grocery stores/1,000 pop\",\"Limited access to healthy foods\",\"SNAP participation rates, all eligible people\",\"SNAP-authorized stores/1,000 pop\",\"Specialized food stores/1,000 pop\",\"WIC coverage rate\",\"WIC eligibility rate\",\"WIC-authorized stores/1,000 pop\",\"Child care centers\",\"Child care cost burden\",\"Uninsured\",\"Homeownership\",\"Severe housing cost burden\",\"Severe housing problems\",\"Median rent as a percentage of income\",\"Rental vacancy rate\",\"Drinking water violations\",\"Adult obesity\",\"Adult smoking\",\"Diabetes prevalence\",\"Drug overdose deaths\",\"Excessive drinking\",\"Infant mortality\",\"Life expectancy\",\"Low birthweight\",\"Motor vehicle crash deaths\",\"Premature age-adjusted mortality\",\"Value of total agricultural exports\",\"value of top five imports\",\"Crop diversity\",\"Mean chemical expenses per operation\",\"Total animal sales\",\"Total crop sales\",\"Total forest product income\",\"Cash receipts value, forest products , all\",\"Value of production, services and forestry, a...\",\"Farms, percent of all farms with value-added ...\",\"Farms, value-added sales as a percent of all ...\",\"Other farm income, insurance indemnities\",\"Other farm income, insurance indemnities, fed...\",\"Value of ad hoc and emergency program payment...\",\"Value of agricultural risk coverage payments,...\",\"Value of all other ad hoc and emergency progr...\",\"Value of dairy margin protection program paym...\",\"Value of price loss coverage payments, all\",\"Children in single-parent households\",\"Disconnected youth\",\"Social associations\",\"Alcohol-impaired driving deaths\",\"Residential segregation - black/white\",\"School segregation\",\"Mean producer age\",\"Ratio of female to male producers\",\"Racial diversity of producers\",\"Voter turnout\"],\"variable_name\":[\"acresPF\",\"medianAcresPF\",\"landValPerAcre\",\"landValPF\",\"totalCapExpBldgsLandNoDwellings\",\"totalCapConsNoDwellings\",\"totalIntExpRealEstateNoDwellings\",\"medianFemaleEarningsFFF\",\"medianFemaleEarningsFPS\",\"medianMaleEarningsFFF\",\"medianMaleEarningsFPS\",\"womenEarnPercMenFFF\",\"womenEarnPercMenFPS\",\"genderPayGap\",\"incomeInequality\",\"gini\",\"unemploymentRate\",\"netReturnOperators\",\"expHiredLaborPercOpExp\",\"farmIncomePF\",\"nMigrantWorkers\",\"nWorkersLE150\",\"nUnpaidWorkers\",\"d2cSalesPerc\",\"agTourSalesPerc\",\"localSalesPerc\",\"propAreaFsaSecDisasters\",\"CH4FromAg\",\"CO2FromAg\",\"N2OFromAg\",\"airPollutionParticulateMatter\",\"forestCarbonDeadDown\",\"forestCarbonLive\",\"forestCarbonDeadStanding\",\"geoexchangeNOps\",\"methaneNOps\",\"solarNOps\",\"windTurbinesNOps\",\"forestDeadTrees\",\"forestCanopyCover\",\"forestLiveTreeVolume\",\"forestStandHeight\",\"forestLiveTrees\",\"pctAtRiskAnimalSpp\",\"pctAtRiskBeeSpp\",\"pctAtRiskOrchidSpp\",\"pctAtRiskPlantSpp\",\"sppAnimals\",\"sppBees\",\"sppOrchids\",\"sppPlants\",\"lulcDiversity\",\"pctAtRiskEcosystems\",\"nEcosystems\",\"lakesLitripcvrCond\",\"lakesRvegCond\",\"riversRipvegCond\",\"riversSalCond\",\"riversNtlCond\",\"riversPtlCond\",\"waterIrrSrcOffFarmExpPerAcreFt\",\"waterIrrSrcOffFarmExp\",\"droughtMeanPercArea\",\"sfaCulturallyRelevant\",\"sfaLocalFoodCosts\",\"sfaServeLocal\",\"sfaFarmToSchool\",\"nCSA\",\"nFarmersMarket\",\"nGrocPTH\",\"limitedAccessToHealthyFoods\",\"snapPercPart\",\"nSnapGrocPTH\",\"nSpecGrocPTH\",\"wicPercPart\",\"wicPercEligible\",\"nWicsGrocPTH\",\"childCareCenters\",\"childCareCostBurden\",\"uninsured\",\"homeownership\",\"severeHousingCostBurden\",\"severeHousingProblems\",\"rentMedianPercHH\",\"vacancyRate\",\"drinkingWaterViolations\",\"adultObesity\",\"adultSmoking\",\"diabetesPrevalence\",\"drugOverdoseDeaths\",\"excessiveDrinking\",\"infantMortality\",\"lifeExpectancy\",\"lowBirthweight\",\"motorVehicleCrashDeaths\",\"prematureAgeAdjustedMortality\",\"exportsTotalAgricultural\",\"importsTopFive\",\"cropDiversity\",\"expChemicalPct\",\"salesAnimal\",\"salesCrop\",\"incForestProducts\",\"totalReceiptsAllForestProducts\",\"totalValueServicesAndForestry\",\"valueAddedFarmsPerc\",\"valueAddedSalesPerc\",\"totalIncomeInsuranceIndemnities\",\"totalIncomeInsuranceIndemnitiesFederal\",\"totalValueEmergPayments\",\"totalValueAgRiskCoveragePayments\",\"totalValueOtherAdHocEmergPayments\",\"totalValueDairyMarginProtPayments\",\"totalValueAllLossCoveragePayments\",\"childrenInSingleParentHouseholds\",\"disconnectedYouth\",\"socialAssociations\",\"alcoholImpairedDrivingDeaths\",\"residentialSegregationBlackWhite\",\"schoolSegregation\",\"ageProducers\",\"ftmProdRatio\",\"producerRacialDiversity\",\"voterTurnout\"],\"has_county\":[true,true,true,true,false,false,false,true,true,true,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,true,false,false,false,false,true,true,true,true,false,false,false,false,true,true,true,true,true,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,false,true,true,false,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,false,true,false,true,true,true,false,false,true,true,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,false,true]},\"columns\":[{\"id\":\"dimension\",\"name\":\"dimension\",\"type\":\"character\"},{\"id\":\"index\",\"name\":\"index\",\"type\":\"character\"},{\"id\":\"indicator\",\"name\":\"indicator\",\"type\":\"character\"},{\"id\":\"metric\",\"name\":\"metric\",\"type\":\"character\"},{\"id\":\"variable_name\",\"name\":\"variable_name\",\"type\":\"character\"},{\"id\":\"has_county\",\"name\":\"has_county\",\"type\":\"logical\"}],\"resizable\":true,\"filterable\":true,\"searchable\":true,\"defaultPageSize\":5,\"showPageSizeOptions\":true,\"onClick\":\"select\",\"highlight\":true,\"bordered\":true,\"striped\":true,\"compact\":true,\"style\":{\"fontSize\":\"14px\"},\"dataKey\":\"1b9db47b713873e817c938f177da2720\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n\n## Explore Trends\n\nTake the county variables we currently have, take the ones that have > 1 year represented, and get a preliminary on if they are changing over time, and if so, in which direction.\n\nFirst get out county level data frame in long format:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome_vars <- c(\n  'foodInsecurity',\n  'communityEnvRank',\n  'happinessScore',\n  'wellbeingRank',\n  'workEnvRank',\n  'foodEnvironmentIndex',\n  'lifeExpectancy',\n  'population',\n  'gdpCurrent'\n)\n\n# Get actual metrics data that at county level only\ncounty_metrics <- metrics %>% \n  filter(\n    variable_name %in% c(county_vars, outcome_vars),\n    str_length(fips) == 5,\n    variable_name != 'unemploymentRate'\n  )\n\nget_str(county_metrics)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [21,870 × 4] (S3: tbl_df/tbl/data.frame)\n $ fips         : chr [1:21870] \"50021\" \"50021\" \"50021\" \"50021\" \"50021\" \"5002\"..\n $ year         : chr [1:21870] \"2015\" \"2015\" \"2015\" \"2015\" \"2015\" \"2015\" \"20\"..\n $ variable_name: chr [1:21870] \"population\" \"rentMedianPercHH\" \"medianFemale\"..\n $ value        : chr [1:21870] \"60530\" \"30.2\" \"16875\" \"26027\" \"17427\" \"24954\"..\n```\n\n\n:::\n:::\n\n\n\n\nThis is our county level metric dataset in long format.\n\nNow prep time series by filter to metrics with > 1 data point. While we're at it, get a sense of what periodicity looks like. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using county metrics data but with all years\nget_str(county_metrics)\nunique(county_metrics$variable_name)\nlength(unique(county_metrics$variable_name))\n\n# Get names of vars that have > 1 time point\nseries_vars <- county_metrics %>% \n  group_by(variable_name) %>% \n  summarize(n_year = length(unique(year))) %>% \n  filter(n_year > 1) %>% \n  pull(variable_name)\nseries_vars\nlen <- length(series_vars)\n# 64 have more than 1 time point. That's actually not bad\n\n# Filter to just those variables so we can do regressions\nseries_metrics <- filter(metrics, variable_name %in% series_vars)\nget_str(series_metrics)\n\n# Side note - what is frequency of years\ntab <- series_metrics %>% \n  group_by(variable_name) %>% \n  mutate(year = as.numeric(year)) %>% \n  summarize(years = list(unique(year))) %>% \n  mutate(diffs = map_dbl(as.vector(years), ~ {\n    unique(diff(sort(.x)))\n  })) %>% \n  pull(diffs) %>% \n  get_table()\ntab\nprop_tab <- prop.table(tab)\n```\n:::\n\n\n\n\n`{r len}` metrics have > 1 data point at county level. `{r prop_tab[1]}`% are annual and `{r prop_tab[2]}`% are every 5 years.\n\nLet's do some linear regressions to what trends look like. Note that I think we should do spatial and/or bayesian regressions for the real thing, but this is what the FSCI did in their 2025 update so it should be enough I suppose.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- map(series_vars, ~ {\n  tryCatch(\n    {\n      df <- series_metrics %>% \n        filter(variable_name == .x) %>% \n        mutate(\n          value = as.numeric(value),\n          year = as.numeric(year)\n        )\n      model <- lm(value ~ year, data = df)\n    },\n    error = function(e) {\n      message(paste('Error with var', .x))\n    }\n  )\n}) %>% \n  setNames(c(series_vars)) %>% \n  discard(\\(x) is.null(x))\n```\n:::\n\n\n\n\nNow that we have regression outputs, let's put them in a table to see which ones were signficant, and in which direction. We also need to pull in our 'directional values' that say which direction is 'good' for each metric. These were defined in the [Aggregation](../pages/aggregation.qmd) from the main analysis branch.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Put together one table of results from all models, add stars\nres_df <- imap(res, ~ {\n  .x %>% \n    tidy() %>% \n    filter(term == 'year') %>% \n    mutate(term = .y)\n}) %>% \n  bind_rows() %>% \n  mutate(sig = ifelse(p.value < 0.05, '*', ''))\nres_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 64 × 6\n   term                              estimate std.error statistic  p.value sig  \n   <chr>                                <dbl>     <dbl>     <dbl>    <dbl> <chr>\n 1 acresPF                           4.71e- 1   3.61e+0  1.31e- 1 8.96e- 1 \"\"   \n 2 adultObesity                      7.37e- 3   1.17e-3  6.27e+ 0 6.87e-10 \"*\"  \n 3 adultSmoking                     -2.36e- 3   9.38e-4 -2.52e+ 0 1.21e- 2 \"*\"  \n 4 agTourSalesPerc                   1.02e- 3   9.55e-4  1.07e+ 0 2.85e- 1 \"\"   \n 5 ageProducers                      2.03e- 1   5.21e-2  3.89e+ 0 1.31e- 4 \"*\"  \n 6 airPollutionParticulateMatter    -2.86e- 1   4.33e-2 -6.61e+ 0 8.87e-11 \"*\"  \n 7 alcoholImpairedDrivingDeaths      6.92e- 4   2.36e-3  2.93e- 1 7.70e- 1 \"\"   \n 8 childCareCenters                  1.81e- 1   3.82e-1  4.74e- 1 6.36e- 1 \"\"   \n 9 childCareCostBurden               2.76e- 2   4.16e-3  6.65e+ 0 1.09e-10 \"*\"  \n10 childrenInSingleParentHouseholds -1.93e- 2   1.73e-3 -1.12e+ 1 2.23e-26 \"*\"  \n11 cropDiversity                    -7.81e- 3   2.95e-3 -2.65e+ 0 8.22e- 3 \"*\"  \n12 d2cSalesPerc                     -3.50e- 3   2.61e-3 -1.34e+ 0 1.81e- 1 \"\"   \n13 diabetesPrevalence               -3.77e- 3   4.96e-4 -7.61e+ 0 1.10e-13 \"*\"  \n14 disconnectedYouth                 1.35e- 3   7.28e-4  1.86e+ 0 6.40e- 2 \"\"   \n15 drinkingWaterViolations          -2.64e- 2   1.20e-2 -2.20e+ 0 2.80e- 2 \"*\"  \n16 drugOverdoseDeaths                1.51e+ 0   2.99e-1  5.05e+ 0 5.89e- 7 \"*\"  \n17 excessiveDrinking                -2.36e- 3   7.91e-4 -2.98e+ 0 3.00e- 3 \"*\"  \n18 expHiredLaborPercOpExp            1.21e- 1   1.15e-1  1.05e+ 0 2.97e- 1 \"\"   \n19 farmIncomePF                      8.49e+ 2   1.36e+2  6.26e+ 0 9.01e-10 \"*\"  \n20 foodEnvironmentIndex              3.13e- 2   3.02e-2  1.03e+ 0 3.01e- 1 \"\"   \n21 foodInsecurity                   -5.02e- 3   6.83e-4 -7.35e+ 0 6.74e-13 \"*\"  \n22 ftmProdRatio                      1.41e- 3   4.02e-3  3.52e- 1 7.25e- 1 \"\"   \n23 genderPayGap                      4.31e- 3   4.21e-3  1.02e+ 0 3.06e- 1 \"\"   \n24 gini                              1.54e- 3   1.76e-4  8.76e+ 0 5.13e-18 \"*\"  \n25 homeownership                     3.47e- 3   2.08e-3  1.67e+ 0 9.52e- 2 \"\"   \n26 incForestProducts                 3.39e+ 5   1.32e+5  2.57e+ 0 1.07e- 2 \"*\"  \n27 incomeInequality                 -4.17e- 3   1.63e-2 -2.56e- 1 7.98e- 1 \"\"   \n28 infantMortality                  -5.38e- 2   4.46e-2 -1.21e+ 0 2.28e- 1 \"\"   \n29 landValPF                         3.00e+ 4   4.71e+3  6.37e+ 0 4.67e-10 \"*\"  \n30 landValPerAcre                    1.76e+ 2   1.29e+2  1.36e+ 0 1.74e- 1 \"\"   \n31 lifeExpectancy                   -2.43e- 1   5.21e-2 -4.66e+ 0 3.88e- 6 \"*\"  \n32 limitedAccessToHealthyFoods       5.24e- 5   7.88e-4  6.65e- 2 9.47e- 1 \"\"   \n33 localSalesPerc                    2.15e- 3   3.81e-3  5.64e- 1 5.74e- 1 \"\"   \n34 lowBirthweight                    5.01e- 4   3.37e-4  1.49e+ 0 1.38e- 1 \"\"   \n35 medianAcresPF                    -7.74e- 1   5.82e-1 -1.33e+ 0 1.84e- 1 \"\"   \n36 medianFemaleEarningsFFF          -2.43e+ 6   4.12e+6 -5.90e- 1 5.56e- 1 \"\"   \n37 medianFemaleEarningsFPS          -8.03e+ 5   4.34e+5 -1.85e+ 0 6.47e- 2 \"\"   \n38 medianMaleEarningsFFF            -2.86e+ 6   1.93e+6 -1.49e+ 0 1.38e- 1 \"\"   \n39 medianMaleEarningsFPS            -1.27e+ 6   1.10e+6 -1.15e+ 0 2.51e- 1 \"\"   \n40 motorVehicleCrashDeaths           5.50e- 2   1.28e-1  4.30e- 1 6.67e- 1 \"\"   \n41 nGrocPTH                         -7.89e- 3   3.44e-3 -2.30e+ 0 2.28e- 2 \"*\"  \n42 nMigrantWorkers                  -1.17e+ 2   1.81e+2 -6.50e- 1 5.16e- 1 \"\"   \n43 nSnapGrocPTH                     -1.95e- 3   6.89e-3 -2.83e- 1 7.77e- 1 \"\"   \n44 nSpecGrocPTH                     -3.64e- 3   3.13e-3 -1.16e+ 0 2.46e- 1 \"\"   \n45 nUnpaidWorkers                   -5.17e+ 2   4.07e+2 -1.27e+ 0 2.05e- 1 \"\"   \n46 nWicsGrocPTH                     -7.75e- 3   2.56e-3 -3.02e+ 0 2.85e- 3 \"*\"  \n47 nWorkersLE150                    -3.57e+ 2   2.49e+2 -1.44e+ 0 1.52e- 1 \"\"   \n48 population                        3.48e+ 5   1.89e+5  1.84e+ 0 6.54e- 2 \"\"   \n49 prematureAgeAdjustedMortality     8.36e+ 0   1.92e+0  4.35e+ 0 1.62e- 5 \"*\"  \n50 rentMedianPercHH                 -1.37e- 1   2.53e-2 -5.43e+ 0 7.36e- 8 \"*\"  \n51 residentialSegregationBlackWhite  6.42e- 1   2.89e-1  2.22e+ 0 2.66e- 2 \"*\"  \n52 salesAnimal                       5.21e+ 7   2.99e+7  1.74e+ 0 8.20e- 2 \"\"   \n53 salesCrop                         6.49e+ 7   3.69e+7  1.76e+ 0 7.95e- 2 \"\"   \n54 schoolSegregation                -3.50e- 3   5.87e-3 -5.96e- 1 5.51e- 1 \"\"   \n55 severeHousingCostBurden          -1.57e- 3   7.39e-4 -2.12e+ 0 3.44e- 2 \"*\"  \n56 severeHousingProblems            -3.36e- 3   8.39e-4 -4.00e+ 0 7.20e- 5 \"*\"  \n57 socialAssociations               -1.22e- 1   9.58e-2 -1.27e+ 0 2.04e- 1 \"\"   \n58 uninsured                        -1.38e- 3   1.03e-3 -1.34e+ 0 1.82e- 1 \"\"   \n59 vacancyRate                      -1.50e- 1   1.75e-1 -8.59e- 1 3.91e- 1 \"\"   \n60 valueAddedFarmsPerc               7.36e- 4   1.45e-3  5.09e- 1 6.11e- 1 \"\"   \n61 valueAddedSalesPerc              -1.00e- 3   1.65e-3 -6.09e- 1 5.43e- 1 \"\"   \n62 voterTurnout                      2.06e-14   1.01e-2  2.05e-12 1.00e+ 0 \"\"   \n63 womenEarnPercMenFFF               1.69e+ 4   1.48e+4  1.14e+ 0 2.53e- 1 \"\"   \n64 womenEarnPercMenFPS              -6.45e- 1   2.85e-1 -2.26e+ 0 2.41e- 2 \"*\"  \n```\n\n\n:::\n\n```{.r .cell-code}\n# How many metrics\nnrow(res_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 64\n```\n\n\n:::\n\n```{.r .cell-code}\n# 63\n\n# How many are significant\nmean(res_df$sig == '*')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.390625\n```\n\n\n:::\n\n```{.r .cell-code}\n# 38% (24 of them)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bring in directional values. If not reverse, then positive is good\nreverse <- readRDS('data/helpers/metrics_value_reversed.rds')\n\n# Of those that are significant, what are trends\nsig_models <- res_df %>% \n  filter(sig == '*') %>% \n  mutate(trend = case_when(\n    estimate > 0 ~ 'increasing',\n    .default = 'decreasing'\n  ))\nsig_models\nmean(sig_models$trend == 'increasing')\n\n# But is this good or bad - bring in directional values\nsig_models <- sig_models %>% \n  mutate(\n    direction = ifelse(term %in% reverse, 'reverse', 'asis'),\n    outcome = case_when(\n      direction == 'asis' & trend == 'increasing' ~ 'better',\n      direction == 'asis' & trend == 'decreasing' ~ 'worse',\n      direction == 'reverse' & trend == 'increasing' ~ 'worse',\n      direction == 'reverse' & trend == 'decreasing' ~ 'better',\n      .default = NA\n    ),\n    across(where(is.numeric), ~ format(round(.x, 3), nsmall = 3))\n  )\nsig_models\n\n# proportion getting better or worse\n(tab <- get_table(sig_models$direction))\nprop.table(tab)\n# Half getting better, half getting worse\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_reactable(sig_models, defaultPageSize = 5)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-545cf3c37c1ac5ac70d2\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-545cf3c37c1ac5ac70d2\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"term\":[\"adultObesity\",\"adultSmoking\",\"ageProducers\",\"airPollutionParticulateMatter\",\"childCareCostBurden\",\"childrenInSingleParentHouseholds\",\"cropDiversity\",\"diabetesPrevalence\",\"drinkingWaterViolations\",\"drugOverdoseDeaths\",\"excessiveDrinking\",\"farmIncomePF\",\"foodInsecurity\",\"gini\",\"incForestProducts\",\"landValPF\",\"lifeExpectancy\",\"nGrocPTH\",\"nWicsGrocPTH\",\"prematureAgeAdjustedMortality\",\"rentMedianPercHH\",\"residentialSegregationBlackWhite\",\"severeHousingCostBurden\",\"severeHousingProblems\",\"womenEarnPercMenFPS\"],\"estimate\":[0.00736638655462227,-0.00236038263563028,0.20273504273496,-0.286141730036555,0.0276412905331964,-0.0193389563223531,-0.00781325274865069,-0.00377142857142869,-0.0264199085257357,1.5114197418971,-0.00235622192529449,849.074388769718,-0.00501596638655474,0.00154332066336955,339026.073999739,29962.5305982909,-0.242804921146237,-0.00789136186185663,-0.00774637485688114,8.36189263497545,-0.137371330764908,0.641670633812803,-0.00156737043420159,-0.00335566908058812,-0.644649486493285],\"std.error\":[0.00117447824797234,0.000937638950711585,0.0521132075182197,0.0433213821599238,0.00415523457955491,0.00173307777326178,0.00295308068957619,0.000495720089623757,0.0119955913268392,0.299208864023606,0.000790695996446411,135.662816559474,0.000682711018344879,0.000176207775641731,132171.623181079,4707.1544829403,0.0520844407454564,0.00343776141699284,0.00256146615979593,1.92315042432422,0.0253209058286965,0.288637525364067,0.000739162276548774,0.000839354507866859,0.285367770635433],\"statistic\":[6.27205022088731,-2.51736836853776,3.89028141597464,-6.60509235324587,6.65216126887287,-11.1587354132156,-2.6457972436141,-7.60798008870518,-2.20246820735075,5.05138691939907,-2.97993405289005,6.25871119517474,-7.34712968118653,8.75852758341074,2.56504434038207,6.3653170311026,-4.66175536630712,-2.29549433618332,-3.02419566514917,4.3480179861197,-5.42521391984421,2.22310190957827,-2.12046864934695,-3.99791631442623,-2.25901293989098],\"p.value\":[6.87135547672584e-10,0.0120859705396799,0.000130834402833205,8.86650894534291e-11,1.09453891143911e-10,2.23112903419337e-26,0.00821797881358844,1.09888472148397e-13,0.0280222278088457,5.89325263515241e-07,0.00300117150699647,9.00909427673718e-10,6.73586542159013e-13,5.13074918422922e-18,0.0106553341761016,4.67048392549541e-10,3.87585045689902e-06,0.0228326844110309,0.00284920632129287,1.61685033754336e-05,7.35978983329272e-08,0.0266259663485834,0.0343810574105005,7.1965259358054e-05,0.0241102450329573],\"sig\":[\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\",\"*\"],\"trend\":[\"increasing\",\"decreasing\",\"increasing\",\"decreasing\",\"increasing\",\"decreasing\",\"decreasing\",\"decreasing\",\"decreasing\",\"increasing\",\"decreasing\",\"increasing\",\"decreasing\",\"increasing\",\"increasing\",\"increasing\",\"decreasing\",\"decreasing\",\"decreasing\",\"increasing\",\"decreasing\",\"increasing\",\"decreasing\",\"decreasing\",\"decreasing\"],\"direction\":[\"asis\",\"asis\",\"reverse\",\"reverse\",\"reverse\",\"reverse\",\"asis\",\"reverse\",\"reverse\",\"reverse\",\"asis\",\"asis\",\"asis\",\"reverse\",\"asis\",\"asis\",\"asis\",\"asis\",\"asis\",\"reverse\",\"asis\",\"reverse\",\"reverse\",\"reverse\",\"asis\"],\"outcome\":[\"better\",\"worse\",\"worse\",\"better\",\"worse\",\"better\",\"worse\",\"better\",\"better\",\"worse\",\"worse\",\"better\",\"worse\",\"worse\",\"better\",\"better\",\"worse\",\"worse\",\"worse\",\"worse\",\"worse\",\"worse\",\"better\",\"better\",\"worse\"]},\"columns\":[{\"id\":\"term\",\"name\":\"term\",\"type\":\"character\"},{\"id\":\"estimate\",\"name\":\"estimate\",\"type\":\"numeric\"},{\"id\":\"std.error\",\"name\":\"std.error\",\"type\":\"numeric\"},{\"id\":\"statistic\",\"name\":\"statistic\",\"type\":\"numeric\"},{\"id\":\"p.value\",\"name\":\"p.value\",\"type\":\"numeric\"},{\"id\":\"sig\",\"name\":\"sig\",\"type\":\"character\"},{\"id\":\"trend\",\"name\":\"trend\",\"type\":\"character\"},{\"id\":\"direction\",\"name\":\"direction\",\"type\":\"character\"},{\"id\":\"outcome\",\"name\":\"outcome\",\"type\":\"character\"}],\"resizable\":true,\"filterable\":true,\"searchable\":true,\"defaultPageSize\":5,\"showPageSizeOptions\":true,\"onClick\":\"select\",\"highlight\":true,\"bordered\":true,\"striped\":true,\"compact\":true,\"style\":{\"fontSize\":\"14px\"},\"dataKey\":\"44477a33b60d3fe8bc246a439c938577\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react-dom.min.js\"></script>\n<script src=\"../site_libs/reactwidget-2.0.0/react-tools.js\"></script>\n<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/reactable-0.4.4/reactable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/reactable-binding-0.4.4/reactable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}