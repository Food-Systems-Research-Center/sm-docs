{
  "hash": "45b1a6ca0b8271f4c6f27db1f942a892",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Economic Indicator Refinement\"\nformat:\n  html:\n    fig-dpi: 200\n---\n\n::: {.cell}\n\n:::\n\n\n\n\nThis page describes the various iterations of indicator sets for the economics dimensions. First, we observe the indicators included in the dimension at three points in time. The second section then shows the results of the survey following the indicator refinement meeting. A final set of indicators to incorporate into the next RFP is still in the works!\n\n## Indicator Progression\n\n### Wiltshire\n\nThis graph shows the original framework as described in the Wiltshire et al. paper.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/econ_wiltshire_tree.csv',\n  dimension_in = 'economics',\n  include_metrics = FALSE,\n  y_limits = c(-1.5, 2.1)\n)\n```\n\n::: {.cell-output-display}\n![](refine_economics_files/figure-html/wiltshire_dendro-1.png){fig-align='center' width=2000}\n:::\n:::\n\n\n\n\n### Matrix\n\nHere is the current set of indicators in the matrix, following the Sustainability Metrics workshop in July, 2024\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/econ_tree.csv',\n  dimension_in = 'economics',\n  y_limits = c(-1.5, 2.1)\n)\n```\n\n::: {.cell-output-display}\n![](refine_economics_files/figure-html/matrix_dendro-1.png){fig-align='center' width=2000}\n:::\n:::\n\n\n\n\n### Refinement Meeting\n\nFinally, the tentative set of indicators following the indicator refinement meeting on November 15th, 2024\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nsource('dev/get_dimension_ggraph.R')\nget_dimension_ggraph(\n  csv_path = 'data/trees/econ_meeting_tree.csv',\n  dimension_in = 'economics',\n  y_limits = c(-1.5, 2.1)\n)\n```\n\n::: {.cell-output-display}\n![](refine_economics_files/figure-html/meeting_dendro-1.png){fig-align='center' width=2000}\n:::\n:::\n\n\n\n\n## Survey\n\nThese are the results from the follow-up survey to the economic indicator refinement meeting on November 15th. This feedback will be used to refine the framework for the next RFP.\n\n### Indicators\n\n\n\n\n::: {.cell warnings='false'}\n\n```{.r .cell-code}\nraw <- read_csv('data/surveys/econ_survey.csv')\n\ndat <- raw %>% \n  select(\n    starts_with('Q'),\n    -ends_with('RANK')\n  ) %>% \n  setNames(c(\n    'indi_must',\n    'indi_probably',\n    'indi_probably_not',\n    'indi_must_not',\n    paste0('add_indi_', 1:3),\n    'notes',\n    'idx_must',\n    'idx_probably',\n    'idx_probably_not',\n    'idx_must_not',\n    paste0('add_idx_', 1:3),\n    'idx_notes',\n    'final_notes'\n  )) %>% \n  .[-c(1:2), ]\n\ngroups <- select(dat, indi_must:indi_must_not, idx_must:idx_probably_not)\n\nto_df <- function(x) {\n  x %>% \n    str_split(',') %>% \n    unlist() %>% \n    table() %>% \n    as.data.frame() %>% \n    setNames(c('indicator', 'freq')) %>% \n    arrange(desc(freq))\n}\n\nindi_out <- map(groups[1:4], to_df)\nidx_out <- map(groups[5:7], to_df)\n\n# Add scores by multipliers\nmultipliers <- c(3:0)\nind_tables <- map2(indi_out, multipliers, ~ {\n  .x %>% \n    mutate(\n      freq = as.numeric(freq),\n      multiplier = .y,\n      score = freq * multiplier,\n    ) %>% \n    select(indicator, freq, score)\n})\n\n# Set up DF for color graph \ngraph_table <- imap(ind_tables, ~ {\n  col_name <- str_remove(.y, 'indi_')\n  .x %>% \n    rename(!!sym(col_name) := freq) %>% \n    select(-score)\n}) %>% \n  reduce(full_join) %>% \n  mutate(\n    across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)),\n    sort_key = must * 1e6 + probably * 1e4 + probably_not * 1e2 + must_not,\n    indicator = fct_reorder(indicator, sort_key, .desc = TRUE)\n  ) %>% \n  pivot_longer(\n    cols = must:must_not,\n    names_to = \"category\",\n    values_to = \"count\"\n  ) %>% \n  mutate(\n    category = fct_relevel(\n      category, \n      \"must_not\",\n      \"probably_not\", \n      \"probably\", \n      \"must\"\n    )\n  ) %>%\n  group_by(indicator) %>%\n  mutate(proportion = count / sum(count)) %>%\n  ungroup()\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(graph_table, aes(\n  y = reorder(indicator, sort_key),\n  x = proportion, \n  fill = category\n)) +\n  geom_col(position = \"stack\") +  \n  labs(\n    y = \"Indicator\",\n    x = \"Proportion\",\n    fill = \"Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 20),\n    legend.position = 'top'\n    ) +\n  scale_fill_brewer(\n    palette = \"RdBu\", \n    direction = -1,\n    limits = c(\n      \"must\",\n      \"probably\", \n      \"probably_not\", \n      \"must_not\" \n    ),\n    labels = c(\n      \"Must Include\", \n      \"Probably Include\", \n      \"Probably Not Include\", \n      \"Must Not Include\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](refine_economics_files/figure-html/indi_graph-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\nWe are coding this so \"Must Include\" is worth 3 points, \"Probably Include\" is worth 2 points, \"Probably Not Include\" is worth 1 point, and \"Must Not Include\" is worth 0 points. Note that the last column is the sum of proportions of \"Must Include\" and \"Probably Include\". You can sort, search, expand, or page through the table below.\n\n\n\n\n::: {.cell warnings='false'}\n\n```{.r .cell-code}\n# Add category to tables\nprops <- ind_tables %>% \n  imap(~ .x %>% mutate(cat = .y)) %>% \n  bind_rows() %>% \n  select(-score)\n \n# Get proportion of probably include OR must include\nprop_prob_or_must_include <- props %>% \n  filter(cat %in% c('indi_must', 'indi_probably')) %>% \n  group_by(indicator) %>% \n  summarize(prop_include = sum(freq) / 6) %>% \n  arrange(desc(prop_include))\n\n# Get proportion of must include\nprop_must_include <- props %>% \n  filter(cat == 'indi_must') %>% \n  group_by(indicator) %>% \n  summarize(prop_must = sum(freq) / 6) %>% \n  arrange(desc(prop_must))\n\n# Add up weighted scores\nind_scores <- ind_tables %>% \n  bind_rows() %>% \n  group_by(indicator) %>% \n  summarize(score = sum(score, na.rm = TRUE)) %>% \n  arrange(desc(score))\n\n# Join everything together\nscores_table <- ind_scores %>% \n  full_join(prop_must_include) %>% \n  full_join(prop_prob_or_must_include) %>% \n  arrange(desc(score)) %>% \n  mutate(\n    across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)),\n    across(c(3:4), ~ format(round(.x, 2), nsmall = 2))\n  ) %>% \n  setNames(c('Indicator', 'Score', 'Proportion Must Include', 'Proportion Must OR Probably Include'))\n```\n:::\n\n::: {.cell class='centered-table'}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-66b8b8f347a369eb0a06\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-66b8b8f347a369eb0a06\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Indicator\":[\"Access to land\",\"Diversity of Farm Types\",\"Income stability\",\"Access to credit\",\"Total sales / revenue\",\"Operations diversification\",\"Market mix\",\"Total costs\",\"Balance sheet (assets and liabilities)\",\"Confidence in future\",\"Labor costs\",\"Percent of farm / business inputs bought locally\",\"Wealth / income distribution\",\"Dependence on off-farm income\",\"Distribution chain capacity\",\"Perceived stability\",\"Satisfaction and / or success scale\",\"Availability of good-paying jobs in food systems\",\"Percent local sales\",\"Use of ag / farm / crop insurance\",\"Acreage in production\",\"Business failure rate of food business\",\"Employee numbers\",\"Enterprise agility / flexibility\",\"Operator salary / wage\",\"Price\",\"Wage rate\",\"In vs. out of state ownership\",\"Marketplace\",\"Operator labor (time and tasks)\",\"Preferences for plant-based proteins\",\"Commercial intent\",\"Commodity price fluctuation\",\"Employee retention\",\"Percent of direct to consumer sales\",\"Business growth / fixed mindset\",\"Consume awareness of VT products\",\"Exchange Rate\",\"VT terroir / VT brand\",\"Capital markets\",\"Forest cover\",\"Open Acres\"],\"Score\":[17,17,17,16,16,15,14,14,13,13,13,13,13,12,12,12,12,11,11,11,10,10,10,10,10,10,10,8,8,8,8,7,7,7,7,6,6,6,5,5,4,4],\"Proportion Must Include\":[\"0.83\",\"0.83\",\"0.83\",\"0.67\",\"0.67\",\"0.67\",\"0.33\",\"0.50\",\"0.33\",\"0.33\",\"0.33\",\"0.50\",\"0.50\",\"0.33\",\"0.50\",\"0.33\",\"0.33\",\"0.33\",\"0.33\",\"0.17\",\"0.33\",\"0.33\",\"0.33\",\"0.33\",\"0.33\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\",\"0.00\"],\"Proportion Must OR Probably Include\":[\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"0.83\",\"1.00\",\"0.83\",\"0.83\",\"0.83\",\"0.83\",\"0.67\",\"0.67\",\"0.67\",\"0.50\",\"0.67\",\"0.67\",\"0.50\",\"0.50\",\"0.67\",\"0.50\",\"0.33\",\"0.50\",\"0.50\",\"0.33\",\"0.67\",\"0.83\",\"0.50\",\"0.50\",\"0.33\",\"0.33\",\"0.17\",\"0.33\",\"0.33\",\"0.33\",\"0.17\",\"0.17\",\"0.00\",\"0.17\",\"0.00\",\"0.00\",\"0.00\"]},\"columns\":[{\"id\":\"Indicator\",\"name\":\"Indicator\",\"type\":\"factor\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"left\"},{\"id\":\"Score\",\"name\":\"Score\",\"type\":\"numeric\",\"format\":{\"cell\":{\"digits\":0},\"aggregated\":{\"digits\":0}},\"minWidth\":75,\"align\":\"right\"},{\"id\":\"Proportion Must Include\",\"name\":\"Proportion Must Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"},{\"id\":\"Proportion Must OR Probably Include\",\"name\":\"Proportion Must OR Probably Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"}],\"resizable\":true,\"filterable\":true,\"searchable\":true,\"defaultPageSize\":10,\"showPageSizeOptions\":true,\"pageSizeOptions\":[5,10,25,50,100],\"bordered\":true,\"striped\":true,\"compact\":true,\"inline\":true,\"dataKey\":\"5c9d80008a450495ef44f7c5a50a0d8e\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n### Indices\n\n\n\n\n::: {.cell layout-align=\"center\" warnings='false'}\n\n```{.r .cell-code}\nidx_out <- map(groups[5:7], to_df)\n\n# Add scores by multipliers\nmultipliers <- c(3:1)\nidx_tables <- map2(idx_out, multipliers, ~ {\n  .x %>% \n    mutate(\n      freq = as.numeric(freq),\n      multiplier = .y,\n      score = freq * multiplier,\n    ) %>% \n    select(index = indicator, freq, score)\n})\n\n# Set up DF for color graph \ngraph_table <- imap(idx_tables, ~ {\n  col_name <- str_remove(.y, 'idx_')\n  .x %>% \n    rename(!!sym(col_name) := freq) %>% \n    select(-score)\n}) %>% \n  reduce(full_join) %>% \n  mutate(\n    across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)),\n    sort_key = must * 1e6 + probably * 1e4 + probably_not,\n    index = fct_reorder(index, sort_key, .desc = TRUE)\n  ) %>% \n  pivot_longer(\n    cols = must:probably_not,\n    names_to = \"category\",\n    values_to = \"count\"\n  ) %>% \n  mutate(\n    category = fct_relevel(\n      category, \n      \"probably_not\", \n      \"probably\", \n      \"must\"\n    )\n  ) %>%\n  group_by(index) %>%\n  mutate(proportion = count / sum(count)) %>%\n  ungroup()\n\n\ncolors <- RColorBrewer::brewer.pal(4, 'RdBu')[2:4]\n\nggplot(graph_table, aes(\n  y = reorder(index, sort_key),\n  x = proportion, \n  fill = category\n)) +\n  geom_col(position = \"stack\") +  \n  labs(\n    y = \"Index\",\n    x = \"Proportion\",\n    fill = \"Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    text = element_text(size = 16),\n    legend.position = 'top'\n    ) +\n  scale_fill_manual(\n    values = rev(colors),\n    limits = c(\n      \"must\",\n      \"probably\",\n      \"probably_not\"\n    ),\n    labels = c(\n      \"Must Include\",\n      \"Probably Include\",\n      \"Probably Not Include\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](refine_economics_files/figure-html/idx_graphs-1.png){fig-align='center' width=75%}\n:::\n:::\n\n\n\n\nThe indices are going through the same treatment as indicators above - scored from 3 to 0. Note that there were no indices rated as \"Must Not Include\". \n\n\n\n\n::: {.cell warnings='false' class='centered-table'}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-e34e603e22d9adea0c43\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e34e603e22d9adea0c43\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Index\":[\"Food business resilience\",\"Community economy\",\"Access to capital / credit\",\"Consumer preferences\",\"Distribution chain localness\",\"Food business profitability\",\"Farmer personal finance\",\"Value from rural landscape\",\"Exogenous factors for business\"],\"Score\":[18,17,16,16,15,15,13,12,11],\"Proportion Must Include\":[\"1.00\",\"0.83\",\"0.67\",\"0.67\",\"0.50\",\"0.67\",\"0.50\",\"0.33\",\"0.17\"],\"Proportion Must OR Probably Include\":[\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"1.00\",\"0.83\",\"0.67\",\"0.67\",\"0.67\"]},\"columns\":[{\"id\":\"Index\",\"name\":\"Index\",\"type\":\"factor\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"left\"},{\"id\":\"Score\",\"name\":\"Score\",\"type\":\"numeric\",\"format\":{\"cell\":{\"digits\":0},\"aggregated\":{\"digits\":0}},\"minWidth\":75,\"align\":\"right\"},{\"id\":\"Proportion Must Include\",\"name\":\"Proportion Must Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"},{\"id\":\"Proportion Must OR Probably Include\",\"name\":\"Proportion Must OR Probably Include\",\"type\":\"character\",\"format\":{\"cell\":{\"digits\":2},\"aggregated\":{\"digits\":2}},\"minWidth\":200,\"align\":\"right\"}],\"resizable\":true,\"filterable\":true,\"searchable\":true,\"pagination\":false,\"defaultPageSize\":10,\"showPageSizeOptions\":false,\"bordered\":true,\"striped\":true,\"compact\":true,\"inline\":true,\"dataKey\":\"c0f602189f107a098b3ca216bbbc9456\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react.min.js\"></script>\n<script src=\"../site_libs/react-18.2.0/react-dom.min.js\"></script>\n<script src=\"../site_libs/reactwidget-2.0.0/react-tools.js\"></script>\n<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/reactable-0.4.4/reactable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/reactable-binding-0.4.4/reactable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}